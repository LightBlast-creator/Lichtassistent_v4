-- Auto-generated by Lichtassistent_v3
-- Generated: 2026-01-06T13:37:29

local show = {
  title = "Demo",
  artist = "",
  venue  = "",
  date   = "",
  seq = 101,
  cues = {
    {
      index  = 1,
      name   = "Jonas",
      mood   = "",
      colors = "",
    },
    {
      index  = 2,
      name   = "Clara",
      mood   = "",
      colors = "",
    },
    {
      index  = 3,
      name   = "Clara",
      mood   = "",
      colors = "",
    },
    {
      index  = 4,
      name   = "Clara",
      mood   = "",
      colors = "",
    },
    {
      index  = 5,
      name   = "Jonas",
      mood   = "",
      colors = "",
    },
    {
      index  = 6,
      name   = "Clara",
      mood   = "",
      colors = "",
    },
    {
      index  = 7,
      name   = "Nacht",
      mood   = "",
      colors = "",
    },
    {
      index  = 8,
      name   = "asd",
      mood   = "asd",
      colors = "asda",
    },
    {
      index  = 9,
      name   = "asd",
      mood   = "",
      colors = "",
    },
  }
}

local function _safe(s)
  if s == nil then return '' end
  s = tostring(s)
  s = string.gsub(s, '"', "'")
  s = string.gsub(s, "[\r\n\t]", " ")
  s = string.gsub(s, "|", "-")
  s = string.gsub(s, "  +", " ")
  return s
end

local function main(display_handle)
  local seq = tonumber(show.seq) or 901  -- Fallback-Sequence
  Printf("Lichtassistent MA3: Import -> " .. tostring(show.title) .. " | Seq " .. tostring(seq))
  Printf("Cues: " .. tostring(#show.cues))

  if #show.cues == 0 then
    Printf("Keine Cues vorhanden – Abbruch.")
    return
  end

  CmdIndirectWait('ClearAll')

  -- Update-Modus: Store /O (überschreibt Cue-Slots, löscht aber nicht die Sequence)
  for _, c in ipairs(show.cues) do
    local label = _safe(c.name)
    if _safe(c.mood) ~= '' or _safe(c.colors) ~= '' then
      label = label .. ' - ' .. _safe(c.mood) .. ' - ' .. _safe(c.colors)
    end
    CmdIndirectWait(string.format('Store Sequence %d Cue %d /O', seq, c.index))
    CmdIndirectWait(string.format('Label Sequence %d Cue %d "%s"', seq, c.index, label))
  end

  CmdIndirectWait(string.format('Label Sequence %d "%s"', seq, _safe(show.title)))
  CmdIndirectWait(string.format('Select Sequence %d', seq))
  Printf("Fertig. Sequence/Cues angelegt oder aktualisiert.")
end

return main
